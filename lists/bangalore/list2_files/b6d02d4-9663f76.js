(function($){var h=$.scrollTo=function(a,b,c){$(window).scrollTo(a,b,c)};h.defaults={axis:"xy",duration:parseFloat($.fn.jquery)>=1.3?0:1,limit:true};h.window=function(a){return $(window)._scrollable()};$.fn._scrollable=function(){return this.map(function(){var a=this,isWin=!a.nodeName||$.inArray(a.nodeName.toLowerCase(),["iframe","#document","html","body"])!=-1;if(!isWin)return a;var b=(a.contentWindow||a).document||a.ownerDocument||a;return/webkit/i.test(navigator.userAgent)||b.compatMode=="BackCompat"?b.body:b.documentElement})};$.fn.scrollTo=function(e,f,g){if(typeof f=="object"){g=f;f=0}if(typeof g=="function")g={onAfter:g};if(e=="max")e=9e9;g=$.extend({},h.defaults,g);f=f||g.duration;g.queue=g.queue&&g.axis.length>1;if(g.queue)f/=2;g.offset=both(g.offset);g.over=both(g.over);return this._scrollable().each(function(){if(e==null)return;var d=this,$elem=$(d),targ=e,toff,attr={},win=$elem.is("html,body");switch(typeof targ){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break}targ=$(targ,this);if(!targ.length)return;case"object":if(targ.is||targ.style)toff=(targ=$(targ)).offset()}$.each(g.axis.split(""),function(i,a){var b=a=="x"?"Left":"Top",pos=b.toLowerCase(),key="scroll"+b,old=d[key],max=h.max(d,a);if(toff){attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]);if(g.margin){attr[key]-=parseInt(targ.css("margin"+b))||0;attr[key]-=parseInt(targ.css("border"+b+"Width"))||0}attr[key]+=g.offset[pos]||0;if(g.over[pos])attr[key]+=targ[a=="x"?"width":"height"]()*g.over[pos]}else{var c=targ[pos];attr[key]=c.slice&&c.slice(-1)=="%"?parseFloat(c)/100*max:c}if(g.limit&&/^\d+$/.test(attr[key]))attr[key]=attr[key]<=0?0:Math.min(attr[key],max);if(!i&&g.queue){if(old!=attr[key])animate(g.onAfterFirst);delete attr[key]}});animate(g.onAfter);function animate(a){$elem.animate(attr,f,g.easing,a&&function(){a.call(this,targ,g)})}}).end()};h.max=function(a,b){var c=b=="x"?"Width":"Height",scroll="scroll"+c;if(!$(a).is("html,body"))return a[scroll]-$(a)[c.toLowerCase()]();var d="client"+c,html=a.ownerDocument.documentElement,body=a.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[d],body[d])};function both(a){return typeof a=="object"?a:{top:a,left:a}}})(jQuery);
var markers=[];var listingMode="list";var dropDownVisibilityTimeOutId=null;var preChangeFilterStatus={};var bookingData=null;var topCities=["Bangalore","Mumbai","Delhi","Chennai","Kolkata","Pune","Hyderabad"];var groupedDoctorsForPractices=null;var searchmap=null;var searchmapbounds=null;var hourify=function(minutes,twentyFourHoursMode,returnMarkup){temp=twentyFourHoursMode?new Date(minutes*6e4).format("HHMM","UTC:"):new Date(minutes*6e4).format("h:MM TT","UTC:");if(returnMarkup){temp=temp.split(" ");return'<span class="strong">'+temp[0]+"</span> "+temp[1]}else{return temp}};var minutify=function(time){timeInt=parseInt(replaceAll(time,":",""),10);return Math.floor(timeInt/100)*60+timeInt%100};var delayedSubmit=null;function roundDec(num,dec){return Math.round(num*Math.pow(10,dec))/Math.pow(10,dec)}function createMap(doctors){if(doctors===null){return}groupedDoctorsForPractices=_.groupBy(doctors,function(thisDoctor){return"clinic_"+thisDoctor.practice.id});var latLngList=[];var isbs_enabled=[];searchmapbounds=new google.maps.LatLngBounds;_.each(groupedDoctorsForPractices,function(doctors,practiceId){if(doctors[0].practice.latitude!==null&&doctors[0].practice.longitude!==null&&doctors[0].practice.latitude!==""&&doctors[0].practice.longitude!==""){latLngList.push(new google.maps.LatLng(parseFloat(doctors[0].practice.latitude),parseFloat(doctors[0].practice.longitude)));searchmapbounds.extend(new google.maps.LatLng(parseFloat(doctors[0].practice.latitude),parseFloat(doctors[0].practice.longitude)))}});var myOptions={zoom:16,maxZoom:18,center:latLngList[0],mapTypeControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP};searchmap=new google.maps.Map(document.getElementById("result_map"),myOptions);searchmap.fitBounds(searchmapbounds);if(searchmap.getZoom()>16){searchmap.setZoom(16)}i=0;_.each(groupedDoctorsForPractices,function(doctors,practiceId){markers[i]=null;if(doctors[0].practice.latitude!==null&&doctors[0].practice.longitude!==null&&doctors[0].practice.latitude!==""&&doctors[0].practice.longitude!==""){markers[i]=new google.maps.Marker({position:new google.maps.LatLng(parseFloat(doctors[0].practice.latitude),parseFloat(doctors[0].practice.longitude)),title:doctors[0].practice.clinic_name,icon:new google.maps.MarkerImage("/bundles/practopractoapp/images/icons/mapmarkers_"+(doctors[0].status==="ABS"?"blue":"green")+".png",new google.maps.Size(25,37),new google.maps.Point(25*i,0),new google.maps.Point(0,37)),animation:google.maps.Animation.DROP,map:searchmap});google.maps.event.addListener(markers[i],"click",function(ev){var selectedLatLng=ev.latLng;var clinicForInfoWindow=_.find(groupedDoctorsForPractices,function(thisGroup){if(thisGroup[0].practice.latitude!==null&&thisGroup[0].practice.longitude!==null){latroundof=thisGroup[0].practice.latitude.toString().length-thisGroup[0].practice.latitude.toString().indexOf(".")-1;lngroundof=thisGroup[0].practice.longitude.toString().length-thisGroup[0].practice.longitude.toString().indexOf(".")-1;return roundDec(selectedLatLng.lat(),latroundof)===thisGroup[0].practice.latitude&&roundDec(selectedLatLng.lng(),lngroundof)===thisGroup[0].practice.longitude}else{return false}});var infoWindow=new google.maps.InfoWindow({position:selectedLatLng,content:_.template($("#map_infowindow_template").html(),{doctors:clinicForInfoWindow,searchfor:searchvars.searchfor}),map:searchmap})});i++}})}function updateCity(newcity,currentSpecialization){if(searchvars.isSpecLandingPage){$(".searchForm input[name='q']").prop("disabled",false);$(".searchForm input[name='locality']").prop("disabled",false)}$.ajax({url:(searchvars.inFrame?"/doctorsearch/":"/")+newcity+"?json=true",dataType:"json",success:function(response){searchvars.results=response.results;searchvars.resultsFound=response.resultsFound;searchvars.next_offset=response.next_offset;searchvars=response;cityName=newcity==="singapore"?"Singapore":_.find(searchvars.cities,function(thisCity){return convertToSlug(thisCity)===newcity});selectedCountry=_.find(searchvars.countries,function(thisCountry){if(cityName==="Singapore"){return thisCountry.name==="Singapore"}else if(cityName==="Metro Manila"){return thisCountry.name==="Philippines"}else{return thisCountry.name==="India"}});$(".searchForm input[name='city']").val(newcity);$(".city-dropdown-activator").removeClass(function(index,css){return(css.match(/\bflag-\S+/g)||[]).join(" ")});if(newcity==="singapore"){flagClass="singapore"}else if(newcity==="metro-manila"){flagClass="philippines"}else{flagClass="india"}$(".city-dropdown-activator").addClass("flag-"+flagClass).html(cityName);setSpecialization=_.isUndefined(currentSpecialization)?searchvars.normalizedForm.q!==null?searchvars.normalizedForm.q:"":currentSpecialization;$(".searchForm input[name='q']").val(setSpecialization);$(".searchForm input[name='locality']").val("").attr("placeholder",searchvars.locality_list.length>0?"eg. "+searchvars.locality_list[0]:"");$(".searchForm input[name='locality']").html("<option></option>");$(".searchForm input[name='locality']").append("<option value=''>All Localities</option>");$("#apptHelpLine").html(selectedCountry.helpline_number)}})}function switchCity(city){updateCity(city,$(".searchForm").find("input[name='q']").val()===""?undefined:$(".searchForm").find("input[name='q']").val())}function sanitizeSlots(originalObj){var newObj={dayString:originalObj.dayString,dateString:originalObj.dateString,slots:[]};_.each(originalObj.slots,function(thisSlot){newObj.slots.push({label:thisSlot.label,ts:thisSlot.ts.year+"-"+thisSlot.ts.month+"-"+thisSlot.ts.date+" "+thisSlot.ts.hour+":"+thisSlot.ts.minute,available:thisSlot.available})});return newObj}function showAvailabiltyCalendar(pdp_id){listingMode="list";$(".result_row_container").show();$(".result_map_container").hide();$("#listView").addClass("selected");$("#mapView").removeClass("selected");$(".result_"+pdp_id+" .showCalendar").click();$(document).scrollTop($(".result_"+pdp_id).offset().top)}function updateResults(){if(delayedSubmit!==null){clearTimeout(delayedSubmit)}if($(".page-body-container").width()>900){delayedSubmit=setTimeout(function(){clearTimeout(delayedSubmit);delayedSubmit=null;$("#resultsRefreshOverlay").css({top:$("#resultsContainer").offset().top+"px",height:$("#resultsContainer").outerHeight()+"px",width:$("#resultsContainer").outerWidth()+"px",left:$("#resultsContainer").offset().left+"px"}).show();var windowHeight=window.innerHeight||document.documentElement.clientHeight||document.documentElement.offsetHeight;var resultsHeight=$("#resultsContainer").offset().top+$("#resultsContainer").outerHeight();if(windowHeight>resultsHeight){$("#resultsRefreshLoader").css({top:$("#resultsContainer").offset().top+Math.floor($("#resultsContainer").outerHeight()/2)+"px",position:"absolute",left:$("#resultsContainer").offset().left+Math.floor($("#resultsContainer").outerWidth()/2)-32+"px"}).show()}else{$("#resultsRefreshLoader").css({top:"50%",position:"fixed",left:$("#resultsContainer").offset().left+Math.floor($("#resultsContainer").outerWidth()/2)-32+"px"}).show()}$("form[name='list_filters']").submit()},2e3)}}function searchCities(term,thisEl){results=searchvars.cities;sortedResults=[];if(term!==""){results=_.filter(searchvars.cities,function(thisCity){var match=thisCity.match(new RegExp(term,"i"));if(match!==null){return true}});sortedResults=_.sortBy(results,function(thisResult){return thisResult.toLowerCase().indexOf(term.toLowerCase())})}else{sortedResults=_.sortBy(searchvars.cities,function(thisCity){return thisCity})}var container=$(thisEl).parents(".other-city-container").find(".other-city-list");container.empty();_.each(sortedResults,function(thisCity){if(_.indexOf(topCities,thisCity)===-1){container.append($("<a>").attr({href:"javascript:void(0);","data-slug":convertToSlug(thisCity),"data-country":"india","class":"city-dropdown-option city-dropdown-city"}).html(thisCity))}})}$(function(){$("#filter-lazy-load-content-block").html($("#filter-lazy-load").html());$.ui.autocomplete.prototype._renderItem=function(ul,item){searchTerm=this.term;t=item.label;var searchfor=$("input[name='searchfor']").val();if(searchTerm.length>0){if(searchfor==="specialization"){var startPos=item.label.toLowerCase().indexOf(searchTerm.toLowerCase());t=item.label.substr(0,startPos);t+='<span style="font-weight:bold;">';t+=item.label.substr(startPos,searchTerm.length);t+="</span>"+item.label.substr(startPos+searchTerm.length)}else{var prefix=_.initial(t.split(" ")).join(" ");prefix=prefix.length>0?prefix+" ":"";suggestedWord='<span style="font-weight:bold;">'+_.last(t.split(" "))+"</span>";t=prefix+suggestedWord}}return $("<li></li>").data("item.autocomplete",item).append("<a>"+t+"</a>").appendTo(ul)};$(".seo-info-body").html($(".search-informative-text").html());$(".searchForm input[name='q'], .searchBar input[name='q']").autocomplete({minLength:0,autoFocus:true,source:function(request,response){var searchfor=$(".searchForm input[name='searchfor']").val();if(searchfor==="specialization"){if($.trim(request.term).length===0){topSpecializations=["Dentist","Dermatologist/cosmetologist","Ayurveda","Homeopath","Gynecologist/obstetrician","Psychologist","Psychiatrist","Ophthalmologist","Physiotherapist","Spa"];topSpecs=_.intersection(topSpecializations,searchvars.specializations);remainingSpecs=_.sortBy(_.difference(searchvars.specializations,topSpecs),function(thisSpec){return thisSpec});return response(_.union(topSpecs,remainingSpecs))}else{results=_.filter(searchvars.specializations,function(thisSpecialty){var match=thisSpecialty.match(new RegExp(request.term,"i"));if(match!==null){return true}});sortedResults=_.sortBy(results,function(thisResult){return thisResult.toLowerCase().indexOf(request.term.toLowerCase())});return response(sortedResults)}}else{var q=$('input[name="q"]').val();var city=$('input[name="city"]').val();if(q){var keywords=q.split(" ");var searchKeyword=_.last(keywords);if(searchKeyword!==""){$.get("/health/api/suggestion?type="+searchfor+"&q="+searchKeyword+"&city="+city).done(function(a,b,c){var suggestions=[];_.each(a.suggestions,function(thisSuggestion){var prefix=_.initial(keywords).join(" ");prefix=prefix.length>0?prefix+" ":"";suggestions.push(prefix+thisSuggestion)});return response(suggestions)})}else{return response([q])}}else{return response([])}}},response:function(event,ui){this.results=ui.content},change:function(event,ui){if($(".searchForm input[name='searchfor']").val()==="specialization"){if(this.results.length===0){$(this).val("")}else{if(ui.item===null&&$.trim($(this).val()).length>0){$(this).val("")}}}}}).focus(function(){$(this).autocomplete("search")});$(".searchForm input[name='locality'], .searchBar.specialization-search input[name='locality']").autocomplete({minLength:0,autoFocus:true,source:function(request,response){if($(".searchForm input[name='searchfor']").val()==="specialization"){if($.trim(request.term).length===0){topLocs=_.intersection(searchvars.topLocs,searchvars.locality_list);remainingLocs=_.sortBy(_.difference(searchvars.locality_list,topLocs),function(thisLoc){return thisLoc});return response(_.union(topLocs,remainingLocs))}else{results=_.filter(searchvars.locality_list,function(thisLocality){var match=thisLocality.match(new RegExp(request.term,"i"));if(match!==null){return true}});results.sort(function(term1,term2){index1=term1.toLowerCase().indexOf(request.term.toLowerCase());index2=term2.toLowerCase().indexOf(request.term.toLowerCase());if(index1!==index2){return index1>index2?1:-1}else{return term1.toLowerCase()>term2.toLowerCase()?1:-1}});return response(results)}}else{return response([])}},response:function(event,ui){this.results=ui.content},change:function(event,ui){if(this.results.length===0){$(this).val("")}else{if(ui.item===null&&$.trim($(this).val()).length>0){$(this).val("")}}}}).focus(function(){$(this).autocomplete("search")});$(".search-bar-tab").live("click",function(ev){ev.preventDefault();$(".search-bar-tab-selected").addClass("search-bar-tab").removeClass("search-bar-tab-selected");$(this).removeClass("search-bar-tab").addClass("search-bar-tab-selected");var searchType=$(this).html()==="SPECIALTY"?"specialization":$(this).html()==="CLINIC"?"practice":"doctor";$(".search-bar").removeClass("specialization-search doctor-search practice-search").addClass(searchType+"-search");$(".search-bar input[name='searchfor']").val(searchType);$(".search-bar input[name='q']").val("");if(!searchvars.isSpecLandingPage){$(".search-bar input[name='q']").attr("placeholder",searchType==="specialization"?"eg. Dentist, Gynecologist":searchType==="doctor"?"eg. Dr. Krishnamurthy":"eg. Smile Dental Clinic")}else{if(searchType==="specialization"){$(".search-bar input[name='q']").val(searchvars.normalizedForm.q).prop("disabled",true)}else{$(".search-bar input[name='q']").attr("placeholder","Select a city first..").prop("disabled",true)}}});$(".home-search-tab").live("click",function(ev){ev.preventDefault();$(".home-search-tab-selected").addClass("home-search-tab").removeClass("home-search-tab-selected");$(this).removeClass("home-search-tab").addClass("home-search-tab-selected");var searchType=$(this).html()==="SPECIALTY"?"specialization":$(this).html()==="CLINIC"?"practice":"doctor";$(".home-search").removeClass("specialization-search doctor-search practice-search").addClass(searchType+"-search");$(".home-search input[name='searchfor']").val(searchType);$(".home-search input[name='q']").val("");$(".home-search input[name='q']").attr("placeholder",searchType==="specialization"?"eg. Dentist, Gynecologist":searchType==="doctor"?"eg. Dr. Krishnamurthy":"eg. Smile Dental Clinic")});$(".city-dropdown-activator").live("focusin, click",function(ev){ev.preventDefault();if(dropDownVisibilityTimeOutId!==null){clearTimeout(dropDownVisibilityTimeOutId);dropDownVisibilityTimeOutId=null}thisEl=this;leftPos=$(thisEl).position().left+$(thisEl).outerWidth()-200;leftPos=leftPos<5?5:leftPos;$(".city-dropdown").css({top:$(thisEl).position().top+$(thisEl).outerHeight()+"px",left:leftPos+"px"}).fadeToggle()});$(".other-city-search-activator").live("click",function(ev){var thisEl=this;$(thisEl).parents(".city-dropdown-country-container").find(".other-city-container").show();$(thisEl).parents(".city-dropdown-country-container").find(".city-dropdown-top-cities-container, .other-city-search-activator").hide();$(thisEl).parents(".city-dropdown-country-container").find("input[name='other-city']").focus()});$(".close-other-city").live("click",function(ev){var thisEl=this;$(thisEl).parents(".city-dropdown-country-container").find("input[name='other-city']").val("");searchCities("",$(thisEl).parents(".city-dropdown-country-container").find("input[name='other-city']"));$(thisEl).parents(".city-dropdown-country-container").find(".other-city-container").hide();$(thisEl).parents(".city-dropdown-country-container").find(".city-dropdown-top-cities-container, .other-city-search-activator").show()});$(".search-query-container").live("click",function(ev){ev.preventDefault();if($(".page-body-container").width()<900){$("form.search-bar").show();$(".searchForm select").trigger("chosen:redraw");$(this).hide()}});$(".city-dropdown-activator, .city-dropdown *").live("focusout",function(){if(dropDownVisibilityTimeOutId!==null){clearTimeout(dropDownVisibilityTimeOutId)}dropDownVisibilityTimeOutId=window.setTimeout(function(){$(".city-dropdown").fadeOut()},200)});$(".city-dropdown, .city-dropdown *").live("focusin",function(){if(dropDownVisibilityTimeOutId!==null){clearTimeout(dropDownVisibilityTimeOutId);dropDownVisibilityTimeOutId=null}});$(".city-dropdown, .city-dropdown *").live("mouseenter",function(){if(dropDownVisibilityTimeOutId!==null){clearTimeout(dropDownVisibilityTimeOutId);dropDownVisibilityTimeOutId=null}});$(".city-dropdown-option").live("click",function(ev){ev.preventDefault();$(".searchForm input[name='city']").val($(this).data("slug"));$(".city-dropdown-activator").removeClass(function(index,css){return(css.match(/\bflag-\S+/g)||[]).join(" ")});$(".city-dropdown-activator").addClass("flag-"+$(this).data("country")).html($(this).html());$(".city-dropdown").fadeOut();$(this).parents(".city-dropdown-country-container").find("input[name='other-city']").val("");$(this).parents(".city-dropdown-country-container").find(".other-city-container").hide();$(this).parents(".city-dropdown-country-container").find(".city-dropdown-top-cities-container, .other-city-search-activator").show();searchCities("",$(this).parents(".city-dropdown-country-container").find("input[name='other-city']"));switchCity($(this).data("slug"))});$("#modify_search").live("click",function(ev){ev.preventDefault();$("#result_search").show();$(".alt_search_link").show();$(this).remove()});if(searchvars.searchfor!=="doctor"&&searchvars.searchfor!=="practice"&&$(".searchForm input[name='city']").val()!==searchvars.form.city){if(!searchvars.isSpecLandingPage){updateCity($(".searchForm input[name='city']").val(),$(".searchForm input[name='q']").val())}else{$(".searchForm input[name='q']").prop("disabled",true);$(".searchForm input[name='locality']").val("").attr("placeholder","Select a city first..").prop("disabled",true);if(window.location.search.length==0){$(".city-dropdown-activator").trigger("click").focus()}}}$("input[name='other-city']").live("keyup",function(ev){term=$.trim($(this).val());searchCities(term,$(this))});$(".searchForm").submit(function(ev){ev.preventDefault();if(searchvars.isSpecLandingPage){$(".city-dropdown-activator").trigger("click").focus();return}var thisForm=this;var tempText="";if(($(thisForm).find("input[name='searchfor']").val()==="doctor"||$(thisForm).find("input[name='searchfor']").val()==="practice")&&$.trim($(thisForm).find("input[name='q']").val()).length<3){return}fetchurl="";if($(thisForm).find("input[name='searchfor']").val()==="doctor"){tempText="Searching for doctor named "+$(thisForm).find("input[name='q']").val();fetchurl="/"+$(thisForm).find("input[name='city']").val()+"?searchfor=doctor&q="+encodeURIComponent($(thisForm).find("input[name='q']").val())}else if($(thisForm).find("input[name='searchfor']").val()==="practice"){tempText="Searching for clinic named "+$(thisForm).find("input[name='q']").val();fetchurl="/"+$(thisForm).find("input[name='city']").val()+"?searchfor=practice&q="+encodeURIComponent($(thisForm).find("input[name='q']").val())}else{var query=$.trim($(".searchForm input[name='q']").val());if(query.length!==0){results=_.filter(searchvars.specializations,function(thisSpecialty){return $.trim(thisSpecialty.toLowerCase())===$.trim(query.toLowerCase())});if(results.length===0){$(".searchForm input[name='q']").val("")}}if($(thisForm).find("input[name='locality']").val()!==""){if($(thisForm).find("input[name='q']").val()!==""){tempText="Searching for "+$(thisForm).find("input[name='q']").val()+" in "+slugToText($(thisForm).find("input[name='locality']").val(),searchvars.locality_list)+", "+slugToText($(thisForm).find("input[name='city']").val(),searchvars.cities)}else{tempText="Searching for Doctors in "+slugToText($(thisForm).find("input[name='locality']").val(),searchvars.locality_list)+", "+slugToText($(thisForm).find("input[name='city']").val(),searchvars.cities)}}else{if($(thisForm).find("input[name='q']").val()!==""){tempText="Searching for "+$(thisForm).find("input[name='q']").val()+" in "+slugToText($(thisForm).find("input[name='city']").val(),searchvars.cities)}else{tempText="Searching for Doctors in "+slugToText($(thisForm).find("input[name='city']").val(),searchvars.cities)}}fetchurl="/"+$(thisForm).find("input[name='city']").val();if($(thisForm).find("input[name='q']").val()!==""){fetchurl+="/"+convertToSlug($(thisForm).find("input[name='q']").val());if($(thisForm).find("input[name='locality']").val()!==""){fetchurl+="/"+convertToSlug($(thisForm).find("input[name='locality']").val())}}else{if($(thisForm).find("input[name='locality']").val()!==""){fetchurl+="/doctors/"+convertToSlug($(thisForm).find("input[name='locality']").val())}}}$(this).parent().find(".searchResultsLoader .loader_text").html(tempText);$(this).parent().find(".searchResultsLoader").show();if($(this).hasClass("home-search")){$(this).hide()}window.location=fetchurl});if(!supportsTouch){$(".searchForm select").chosen({search_contains:true})}else{$(".searchForm input[name='locality'] > option:eq(0)").attr("value","").html("eg. "+searchvars.topLocalities[0])}$(".search").live("click",function(ev){ev.preventDefault();if(typeof ga!=="undefined"){ga("send","event","Search","Home Page","Search Button was clicked")}$(this).parents(".searchForm").submit()});$(".search_button").live("click",function(ev){ev.preventDefault();if(typeof ga!=="undefined"){ga("send","event","Search","Listings Page","Search Button was clicked")}$(this).parents(".searchForm").submit()});$(document).live("keypress",function(ev){var parentForm=$(ev.target).parents("searchForm");if(ev.keyCode===13&&($(ev.target).hasClass("searchForm")||parentForm.length>0)){$(".searchForm").submit()}});$("#dayFilters").buttonset().redraw();$("input[name='filters[abs]'],input[name='filters[locations][]']").button({text:false});$(".abs_enabled").live("mouseenter",function(){el=this;if($(".page-body-container").width()>900){$("#absTooltip").css({top:$(el).offset().top-35+"px",left:$(el).offset().left-82+"px"}).fadeIn()}else{$("#absTooltip").hide()}});$(".abs_enabled").live("mouseleave",function(){$("#absTooltip").hide()});$("#absFilters .help").live("mouseenter",function(){el=this;if($(".page-body-container").width()>900){$("#absInfoTooltip").css({width:"200px",top:$(el).offset().top-50+"px",left:$(el).offset().left+$(el).outerWidth()+10+"px"}).fadeIn()}else{$("#absInfoTooltip").hide()}});$("#absFilters .help").live("mouseleave",function(){$("#absInfoTooltip").hide()});if($("#timingSlider").length>0){$("#timingSlider").slider({range:true,min:0,max:1410,step:30,values:[minutify($("input[name='filters[min_time]']").val()),minutify($("input[name='filters[max_time]']").val())],slide:function(event,ui){$("input[name='filters[min_time]']").val(hourify(ui.values[0],true));$("input[name='filters[max_time]']").val(hourify(ui.values[1],true));$("#timingRange").html(hourify(ui.values[0],false,true)+" - "+hourify(ui.values[1],false,true));updateResults()}}).draggable()}if($("#feeSlider").length>0){$("#feeSlider").slider({range:true,min:0,max:searchvars.filters.max_fee_range,step:50,values:[$("input[name='filters[min_fee]']").val(),$("input[name='filters[max_fee]']").val()],slide:function(event,ui){$("input[name='filters[min_fee]']").val(ui.values[0]);$("input[name='filters[max_fee]']").val(ui.values[1]);$("#feeRange").html((ui.values[0]===0?"Free":ui.values[0])+" - "+(ui.values[1]===0?"Free":ui.values[1]));updateResults()}}).draggable()}$(".filters-toggle").click(function(){preChangeFilterStatus={checkboxes:{},others:{}};$.each($("form[name='list_filters'] input[type='checkbox']"),function(){preChangeFilterStatus.checkboxes[$(this).attr("id")]=$(this).is(":checked")});$.each($("form[name='list_filters'] input[type='hidden']"),function(){preChangeFilterStatus.others[$(this).attr("name")]=$(this).val()});$(".filters-hidden").addClass("filters-visible").removeClass("filters-hidden")});$(".close-filter-button").click(function(){$(".filters-visible").addClass("filters-hidden").removeClass("filters-visible");$.each(preChangeFilterStatus.checkboxes,function(key,wasChecked){if(wasChecked){$("form[name='list_filters'] input[id='"+key+"']").attr("checked","checked")}else{$("form[name='list_filters'] input[id='"+key+"']").removeAttr("checked")}});$.each(preChangeFilterStatus.others,function(key,value){$("form[name='list_filters'] input[name='"+key+"']").val(value)});feeValues=[$("input[name='filters[min_fee]']").val(),$("input[name='filters[max_fee]']").val()];timeValues=[minutify($("input[name='filters[min_time]']").val()),minutify($("input[name='filters[max_time]']").val())];$("#feeSlider").slider("option",{values:feeValues});$("#timingSlider").slider("option",{values:timeValues});$("#timingRange").html(hourify(timeValues[0],false,true)+" - "+hourify(timeValues[1],false,true));$("#feeRange").html((feeValues[0]===0?"Free":feeValues[0])+" - "+(feeValues[1]===0?"Free":feeValues[1]));$(".abs_filters input, .location_filters input").button("refresh");$("#dayFilters").buttonset("refresh");$("#any_day").button("refresh")});$(".abs_filters input").click(function(){updateResults()});$(".location_filters input").click(function(){updateResults()});$("#dayFilters input[value!='any']").click(function(){if($(this).is(":checked")&&$("#any_day").is(":checked")){$("#any_day").removeAttr("checked");$("#any_day").button("refresh")}if($("#dayFilters input[value!='any']:checked").length===0){$("#any_day").attr("checked","checked");$("#dayFilters").buttonset("refresh")}updateResults()});$("#any_day").click(function(){if($("#any_day").is(":checked")){$("#dayFilters input[value!='any']").removeAttr("checked");$("#dayFilters").buttonset("refresh")}updateResults()});$(".clinic_thumbs img").error(function(){originalSrc=$(this).data("originalsrc");$(this).data("originalsrc","");if(originalSrc!==""){$(this).attr("src",originalSrc);$(this).parent().attr("href",$(this).data("originalsrc"))}else{$(this).parents(".clinic_thumbs").remove()}});$(".doc_avatar").error(function(){originalSrc=$(this).data("originalsrc");$(this).attr("src",originalSrc);$(this).attr("data-originalsrc","/bundles/practopractoapp/images/profile.png")});$(".apply-filter-button").click(function(){$("form[name='list_filters']").submit()});$(".filter_accordion").click(function(){$(this).toggleClass("open fold");$("."+$(this).data("type")+"_filters").toggleClass("filter-show filter-hide")});$(".labelForFilterCheckboxes").click(function(){$("#"+$(this).data("chkbxid")).click()});$(window).resize(function(){if($(".searchForm").length>0){$(".searchForm select").trigger("chosen:redraw");leftPos=$(".city-dropdown-activator").position().left+$(".city-dropdown-activator").outerWidth()-200;leftPos=leftPos<0?0:leftPos;$(".city-dropdown").css({top:$(".city-dropdown-activator").position().top+$(".city-dropdown-activator").outerHeight()+"px",left:leftPos+"px"})}});$(".practo-service-container-header").click(function(ev){if(typeof $.scrollTo==="function"){$.scrollTo($(".practo-service-wrapper").position().top,{duration:500})}});$(".practo-service-ray-toggle-link").click(function(ev){$(".practo-service-ray-toggle-link").addClass("selected");$(".practo-service-search-toggle-link").removeClass("selected");$("#practo-search-service-block").addClass("responsive-hide");$("#practo-ray-service-block").removeClass("responsive-hide")});$(".practo-service-search-toggle-link").click(function(ev){$(".practo-service-search-toggle-link").addClass("selected");$(".practo-service-ray-toggle-link").removeClass("selected");$("#practo-ray-service-block").addClass("responsive-hide");$("#practo-search-service-block").removeClass("responsive-hide")});$(".reschedule-appointment-head").click(function(ev){$(".reschedule-appointment-head").toggleClass("expanded collapsed");$(".reschedule-appointment-details").toggleClass("responsive-hide")});$(".cancel-appointment-head").click(function(ev){$(".cancel-appointment-head").toggleClass("expanded collapsed");$(".cancel-appointment-details").toggleClass("responsive-hide")})});
(function(){var sixpack={base_url:"http://localhost:5000",ip_address:null,user_agent:null,timeout:1e3};var on_node=false;if(typeof module!=="undefined"&&typeof require!=="undefined"){on_node=true;module.exports=sixpack}else{window["sixpack"]=sixpack}sixpack.generate_client_id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};sixpack.Session=function(client_id,base_url,ip_address,user_agent,timeout){this.client_id=client_id||sixpack.generate_client_id();this.base_url=base_url||sixpack.base_url;this.ip_address=ip_address||sixpack.ip_address;this.user_agent=user_agent||sixpack.user_agent;if(!on_node){this.user_agent=this.user_agent||window&&window.navigator&&window.navigator.userAgent}this.timeout=timeout||sixpack.timeout};sixpack.Session.prototype={participate:function(experiment_name,alternatives,force,callback){if(typeof force==="function"){callback=force;force=null}if(!/^[a-z0-9][a-z0-9\-_ ]*$/.test(experiment_name)){return callback(new Error("Bad experiment_name"))}if(alternatives.length<2){return callback(new Error("Must specify at least 2 alternatives"))}for(var i=0;i<alternatives.length;i+=1){if(!/^[a-z0-9][a-z0-9\-_ ]*$/.test(alternatives[i])){return callback(new Error("Bad alternative name: "+alternatives[i]))}}var params={client_id:this.client_id,experiment:experiment_name,alternatives:alternatives};if(!on_node&&force==null){var regex=new RegExp("[\\?&]sixpack-force-"+experiment_name+"=([^&#]*)");var results=regex.exec(window.location.search);if(results!=null){force=decodeURIComponent(results[1].replace(/\+/g," "))}}if(force!=null&&_in_array(alternatives,force)){return callback(null,{status:"ok",alternative:{name:force},experiment:{version:0,name:experiment_name},client_id:this.client_id})}if(this.ip_address){params.ip_address=this.ip_address}if(this.user_agent){params.user_agent=this.user_agent}return _request(this.base_url+"/participate",params,this.timeout,function(err,res){if(err){res={status:"failed",error:err,alternative:{name:alternatives[0]}}}return callback(null,res)})},convert:function(experiment_name,callback){if(!/^[a-z0-9][a-z0-9\-_ ]*$/.test(experiment_name)){return callback(new Error("Bad experiment_name"))}var params={experiment:experiment_name,client_id:this.client_id};if(this.ip_address){params.ip_address=this.ip_address}if(this.user_agent){params.user_agent=this.user_agent}return _request(this.base_url+"/convert",params,this.timeout,function(err,res){if(err){res={status:"failed",error:err}}return callback(null,res)})}};var counter=0;var _request=function(uri,params,timeout,callback){var timed_out=false;var timeout_handle=setTimeout(function(){timed_out=true;return callback(new Error("request timed out"))},timeout);if(!on_node){var cb="callback"+ ++counter;params.callback="sixpack."+cb;sixpack[cb]=function(res){if(!timed_out){clearTimeout(timeout_handle);return callback(null,res)}}}var url=_request_uri(uri,params);if(!on_node){script=document.createElement("script");script.type="text/javascript";script.src=url;script.async=true;document.body.appendChild(script)}else{var http=require("http");var req=http.get(url,function(res){var body="";res.on("data",function(chunk){return body+=chunk});return res.on("end",function(){var data;if(res.statusCode==500){data={status:"failed",response:body}}else{data=JSON.parse(body)}if(!timed_out){clearTimeout(timeout_handle);return callback(null,data)}})});req.on("error",function(err){if(!timed_out){clearTimeout(timeout_handle);return callback(err)}})}};var _request_uri=function(endpoint,params){var query_string=[];var e=encodeURIComponent;for(var key in params){if(params.hasOwnProperty(key)){var vals=params[key];if(Object.prototype.toString.call(vals)!=="[object Array]"){vals=[vals]}for(var i=0;i<vals.length;i+=1){query_string.push(e(key)+"="+e(vals[i]))}}}if(query_string.length){endpoint+="?"+query_string.join("&")}return endpoint};var _in_array=function(a,v){for(var i=0;i<a.length;i++){if(a[i]===v){return true}}return false}})();
var slots={},tokens={},inFrame=searchvars?searchvars.inFrame:null,dayNames=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],shortDayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortMonthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],millisecondsInADay=1e3*60*60*24,millisecondsIn2Hours=2*60*60*1e3;$(function(){if($(".book-toggle").length>0){$(".book-toggle").removeAttr("checked").button()}$(".button.day-switcher.next").live("click",function(){container=$(this).parents(".slot-viewer");prevButton=$(this).parents(".slot-viewer").find(".button.day-switcher.prev");var firstVisible=parseInt(prevButton.data("id"));if($(".page-body-container").width()>900||$(".patient-profile-view").length>0){if(firstVisible+3<container.find(".slots-group").length){container.find(".slots-group").eq(firstVisible).hide();container.find(".slots-group").eq(firstVisible+3).show();container.find(".button.day-switcher.prev").data("id",firstVisible+1).removeClass("disabled")}if(firstVisible+4>=container.find(".slots-group").length){$(this).addClass("disabled")}}else{if(firstVisible+1<container.find(".slots-group").length){container.find(".slots-group").eq(firstVisible).hide();container.find(".slots-group").eq(firstVisible+1).show();container.find(".button.day-switcher.prev").data("id",firstVisible+1).removeClass("disabled")}if(firstVisible+2>=container.find(".slots-group").length){$(this).addClass("disabled")}}});$(".button.day-switcher.prev").live("click",function(){container=$(this).parents(".slot-viewer");prevButton=$(this);var firstVisible=parseInt(prevButton.data("id"));if($(".page-body-container").width()>900||$(".patient-profile-view").length>0){if(firstVisible>0){container.find(".slots-group").eq(firstVisible-1).show();container.find(".slots-group").eq(firstVisible+2).hide();prevButton.data("id",firstVisible-1);container.find(".button.day-switcher.next").removeClass("disabled")}if(firstVisible-1<=0){$(this).addClass("disabled")}}else{if(firstVisible>0){container.find(".slots-group").eq(firstVisible-1).show();container.find(".slots-group").eq(firstVisible).hide();prevButton.data("id",firstVisible-1);container.find(".button.day-switcher.next").removeClass("disabled")}if(firstVisible-1<=0){$(this).addClass("disabled")}}});$(".slot-viewer input[type='radio']").live("click",function(){$(this).parents("form.slot-viewer").submit()});$(".book-toggle").live("click",function(ev){var el=this;var suffix=$(el).data("adid")?"_"+$(el).data("adid"):$(el).data("uniqid")?"_"+$(el).data("uniqid"):"";var thisDoc=null;if($(el).is("input")&&$(el).is(":checked")===false||$(el).is("a")&&$(el).hasClass("showSlotViewer")===false){return $("#slotViewer"+$(el).data("doctorid")+suffix).slideUp()}if($("#slotViewer"+$(el).data("doctorid")+suffix).children().length>0){$("#slotViewer"+$(el).data("doctorid")+suffix).slideDown();if(typeof $.scrollTo==="function"){var windowHeight=window.innerHeight||document.documentElement.clientHeight||document.documentElement.offsetHeight;$.scrollTo($(el).parents(".listing-row").position().top-100,{duration:500})}return}if(typeof ga!=="undefined"){var payload={};_.extend(payload,gadimensions,{hitType:"event",eventCategory:"ad_click",eventAction:"click",eventLabel:"book_appointment",dimension1:$(el).data("adid")?$(el).data("adid"):"organic",dimension3:$(el).data("origin"),dimension8:$(el).data("doctorid"),dimension9:$(el).data("practiceid"),dimension12:$(el).data("adplanname")?$(el).data("adplanname"):"organic",dimension13:$(el).data("subscriptionid")?$(el).data("subscriptionid"):"organic",dimension14:$(el).data("adtype")?$(el).data("adtype"):"organic"});ga("send",payload)}if(typeof $.scrollTo==="function"){windowHeight=window.innerHeight||document.documentElement.clientHeight||document.documentElement.offsetHeight;$.scrollTo($(el).parents(".listing-row").position().top-100,{duration:500})}$("#slotViewer"+$(el).data("doctorid")+suffix).html("<div class='slot-loader'><img src='"+window.practo.fabric_host+"/bundles/practopractoapp/images/slot-loader.png'/><p style='margin-left:-10px;margin-bottom:30px;color:#999;'>Pick a slot..</p></div>");$("#slotViewer"+$(el).data("doctorid")+suffix).slideDown("fast");var doctorId=$(el).data("doctorid");if($(el).data("adid")){thisDoc=_.find(adDoctors,function(thisDoctor){return parseInt(thisDoctor.ad.id,10)===$(el).data("adid")});thisDoc.abs_enabled=thisDoc.status==="ABS"&&thisDoc.bs_enabled;thisDoc.isVN=thisDoc.status==="VN";thisDoc.appointment_duration=thisDoc.appointment_duration||30}else if(typeof doctorRelations!=="undefined"){relation=_.find(doctorRelations,function(thisRelation){return thisRelation.id===doctorId});thisDoc={appointment_duration:relation.appointment_duration||30,id:relation.id,visit_timings:relation.visit_timings!==null?isScheduleEmpty(relation.visit_timings):isScheduleEmpty(practice.timings),abs_enabled:practice.abs_active&&relation.status==="ABS",isVN:relation.status==="VN"}}else if(typeof practiceRelations!=="undefined"){relation=_.find(practiceRelations,function(thisRelation){return thisRelation.id===doctorId});thisDoc={appointment_duration:relation.appointment_duration||30,id:relation.id,visit_timings:relation.visit_timings!==null?isScheduleEmpty(relation.visit_timings):isScheduleEmpty(relation.practice_timings),abs_enabled:relation.practice_abs_active&&relation.status==="ABS",isVN:relation.status==="VN"}}else if(searchvars!==null&&typeof searchvars.results!=="undefined"&&$(el).data("origin")==="Listings"&&searchvars.listingType=="doctors"){thisDoc=_.find(searchvars.results,function(thisDoctor){return thisDoctor.id===doctorId});thisDoc.abs_enabled=thisDoc.status==="ABS"&&thisDoc.bs_enabled;thisDoc.isVN=thisDoc.status==="VN"}else if(searchvars===null&&typeof practiceRelations==="undefined"){var payload={with_relation:true};$.ajax({url:"/health/core-api/practicedoctors/"+doctorId+"/slots",type:"GET",data:payload,dataType:"json",async:false,success:function(response){if(response){thisDoc=response.relation}}})}function renderCalendar(){var temp=_.template($("#slotViewerTemplate").html(),{daySlots:slots["doctor_"+doctorId],doctor:thisDoc,abs_enabled:thisDoc.abs_enabled,appointment_token:tokens["doctor_"+doctorId]});var suffix=$(el).data("adid")?"_"+$(el).data("adid"):$(el).data("uniqid")?"_"+$(el).data("uniqid"):"";if($(".patient-profile-view").length>0){$(el).data("appttype",temp.abs_enabled?"ABS":"REQUEST")}$("#slotViewer"+$(el).data("doctorid")+suffix).append(temp);if($(".page-body-container").width()>900||$(".patient-profile-view").length>0){if($(".day-slot-column:eq(0)").parent().hasClass("day-slot-grouping")){$(".day-slot-column:eq(0)").unwrap()}$("#slotViewer"+$(el).data("doctorid")+suffix+" .slots-group:gt(2)").hide();$("#slotViewer"+$(el).data("doctorid")+suffix+" .slots-group:lt(3)").show()}else{$.each($("#slotViewer"+$(el).data("doctorid")+suffix+" .slots-group"),function(){if($(this).children().length>0){if($(this).find("day-slot-grouping").length===0){$(this).find(".day-slot-column:eq(0),.day-slot-column:eq(1)").wrapAll($("<div></div>").addClass("day-slot-grouping"));$(this).find(".day-slot-column:eq(2),.day-slot-column:eq(3)").wrapAll($("<div></div>").addClass("day-slot-grouping"));$(this).find(".day-slot-column:eq(4),.day-slot-column:eq(5)").wrapAll($("<div></div>").addClass("day-slot-grouping"));$(this).find(".day-slot-column:eq(6)").wrapAll($("<div></div>").addClass("day-slot-grouping"))}}});$("#slotViewer"+$(el).data("doctorid")+suffix+" .slots-group:gt(0)").hide();$("#slotViewer"+$(el).data("doctorid")+suffix+" .slots-group:eq(0)").show()}$("#slotViewer"+$(el).data("doctorid")+suffix+" input[type='radio']").button();$("#slotViewer"+$(el).data("doctorid")+suffix+" .slot-loader").remove();$("#slotViewer"+$(el).data("doctorid")+suffix).fadeIn();if(typeof $.scrollTo==="function"){var windowHeight=window.innerHeight||document.documentElement.clientHeight||document.documentElement.offsetHeight;$.scrollTo($(el).parents(".listing-row").position().top-100)}}if(thisDoc&&thisDoc.isVN){showPatientForm(el,suffix)}else if(_.isUndefined(slots["doctor_"+doctorId])){if(typeof thisDoc!=="undefined"&&thisDoc&&thisDoc.abs_enabled===false){var appointmentDuration=thisDoc.appointment_duration||30;var abtTeamStartTime=8,abtTeamEndTime=19,numberOfHoursGap=2,visitTimings=thisDoc.visit_timings;var setTime=function(myDate,data){var newDate=new Date(myDate.getTime());var time=data.split(":");newDate.setHours(time[0],time[1],0,0);return newDate};var newSlots=[];var getSlotIndex=function(time){var currentSlotIndex=time.getHours()*60/appointmentDuration;if(time.getMinutes()>=appointmentDuration){currentSlotIndex+=parseInt(time.getMinutes()/appointmentDuration)}return currentSlotIndex};var createSlots=function(todayDate){var todayDateDay=dayNames[todayDate.getDay()],slot={};slot.day=shortDayNames[todayDate.getDay()];slot.date=todayDate.getDate()+" "+shortMonthNames[todayDate.getMonth()];var dates=[],dayStartTime=new Date(todayDate.getTime());dayStartTime.setHours(0,0,0,0);var dayEndTime=new Date(todayDate.getTime());dayEndTime.setHours(23,59,59,999);breakTime(dayStartTime,dayEndTime,dates);var setAvailability=function(key,value){if(typeof session1StartIndex!=="undefined"&&typeof session2StartIndex!=="undefined"){if(value<session1StartIndex||value>session1EndIndex&&value<session2StartIndex||value>session2EndIndex){key.available=false}}else if(typeof session1StartIndex!=="undefined"&&typeof session2StartIndex==="undefined"){if(value<session1StartIndex||value>session1EndIndex){key.available=false}}else if(typeof session1StartIndex==="undefined"&&typeof session2StartIndex==="undefined"){key.available=false}};var numberOfSlots=dates.length,session1StartTime,session1EndTime,session2StartTime,session2EndTime,session1StartIndex,session1EndIndex,session2StartIndex,session2EndIndex;if(visitTimings[todayDateDay].session1_start_time!==""&&visitTimings[todayDateDay].session2_start_time!==""){session1StartTime=setTime(todayDate,visitTimings[todayDateDay].session1_start_time);session1EndTime=setTime(todayDate,visitTimings[todayDateDay].session1_end_time);session2StartTime=setTime(todayDate,visitTimings[todayDateDay].session2_start_time);session2EndTime=setTime(todayDate,visitTimings[todayDateDay].session2_end_time);session1StartIndex=getSlotIndex(session1StartTime);session1EndIndex=getSlotIndex(session1EndTime);session2StartIndex=getSlotIndex(session2StartTime);session2EndIndex=getSlotIndex(session2EndTime);_.each(dates,setAvailability);delete session1StartIndex,session1EndIndex,session2StartIndex,session2EndIndex}else if(visitTimings[todayDateDay].session1_start_time!==""&&visitTimings[todayDateDay].session2_start_time===""){session1StartTime=setTime(todayDate,visitTimings[todayDateDay].session1_start_time);session1EndTime=setTime(todayDate,visitTimings[todayDateDay].session1_end_time);session1StartIndex=getSlotIndex(session1StartTime);session1EndIndex=getSlotIndex(session1EndTime);_.each(dates,setAvailability);delete session1StartIndex,session1EndIndex,session2StartIndex,session2EndIndex}else if(visitTimings[todayDateDay].session1_start_time===""&&visitTimings[todayDateDay].session2_start_time!==""){session2StartTime=setTime(todayDate,visitTimings[todayDateDay].session2_start_time);session2EndTime=setTime(todayDate,visitTimings[todayDateDay].session2_end_time);session2StartIndex=getSlotIndex(session2StartTime);session2EndIndex=getSlotIndex(session2EndTime);_.each(dates,setAvailability);delete session1StartIndex,session1EndIndex,session2StartIndex,session2EndIndex}else if(visitTimings[todayDateDay].session1_start_time===""&&visitTimings[todayDateDay].session2_start_time===""){_.each(dates,setAvailability);delete session1StartIndex,session1EndIndex,session2StartIndex,session2EndIndex}slot.slots=dates;return slot};var breakTime=function(startTime,endTime,dates){while(startTime<endTime){var availabilitySlot={ts:startTime.format("yyyy-mm-dd HH:MM:ss"),available:true};dates.push(availabilitySlot);startTime=new Date(startTime.getTime()+1e3*60*appointmentDuration)}};var startingToday=function(){var today=new Date;today.setHours(0,0,0,0);var startTime=today.getTime();var endTime=startTime+14*864e5;for(var a=startTime;a<endTime;a+=864e5){dayslots=createSlots(new Date(a));newSlots.push(dayslots)}newSlots=blockLeadTime(newSlots)};var blockLeadTime=function(newSlots){var currentTime=new Date;var tomorrowTime=new Date(currentTime.getTime()+millisecondsInADay);var currentSlotIndex=getSlotIndex(currentTime);var allSlotsToBlock=[];var numberOfSlots2hours=60*2/appointmentDuration;var totalNumberOfSlotsSameDay=newSlots[0].slots.length;var todayDateDay=dayNames[currentTime.getDay()];var tomorrowDateDay=dayNames[tomorrowTime.getDay()];var earlyHours=new Date;earlyHours.setHours(8,0,0,0);var earlyHoursSlotIndex=getSlotIndex(earlyHours);var lateHours=new Date;lateHours.setHours(17,0,0,0);var lateHours7=new Date;lateHours7.setHours(19,0,0,0);var session1StartTime,session1EndTime,session2StartTime,session2EndTime,session1StartIndex,session1EndIndex,session2StartIndex,session2EndIndex,session1EndTimeMinus2;var nextDaySession1StartTime=setTime(tomorrowTime,visitTimings[tomorrowDateDay].session1_start_time);var nextDaySession1StartIndex=getSlotIndex(nextDaySession1StartTime);if(visitTimings[todayDateDay].session1_start_time!==""&&visitTimings[todayDateDay].session2_start_time!==""){session1StartTime=setTime(currentTime,visitTimings[todayDateDay].session1_start_time);session1EndTime=setTime(currentTime,visitTimings[todayDateDay].session1_end_time);session2StartTime=setTime(currentTime,visitTimings[todayDateDay].session2_start_time);session2EndTime=setTime(currentTime,visitTimings[todayDateDay].session2_end_time);session1StartIndex=getSlotIndex(session1StartTime);session1EndIndex=getSlotIndex(session1EndTime);session2StartIndex=getSlotIndex(session2StartTime);session2EndIndex=getSlotIndex(session2EndTime);session1EndTimeMinus2=new Date(session1EndTime.getTime()-1e3*60*60*2);if(currentTime<session1StartTime){if(session1StartIndex<earlyHoursSlotIndex){var slotIndex1=session1StartIndex;while(slotIndex1!==earlyHoursSlotIndex){newSlots[0].slots[slotIndex1].available=false;slotIndex1+=1}for(var b=0;b<numberOfSlots2hours;b+=1){newSlots[0].slots[earlyHoursSlotIndex+b].available=false}}else{for(var c=0;c<numberOfSlots2hours;c+=1){newSlots[0].slots[session1StartIndex+c].available=false}}if(session1EndTime.getTime()-session1StartTime.getTime()<millisecondsIn2Hours){for(var d=0;d<numberOfSlots2hours;d+=1){newSlots[0].slots[session2StartIndex+d].available=false}}}else if(currentTime>session1EndTimeMinus2&&currentTime<session2StartTime){for(var e=0;e<numberOfSlots2hours;e+=1){newSlots[0].slots[session2StartIndex+e].available=false}if(session2EndTime.getTime()-session2StartTime.getTime()<millisecondsIn2Hours){blockNextDaySlots(newSlots,earlyHoursSlotIndex)}else if(lateHours7.getTime()-session2StartTime.getTime()<millisecondsIn2Hours){blockNextDaySlots(newSlots,earlyHoursSlotIndex);for(var f=currentSlotIndex;f<totalNumberOfSlotsSameDay;f+=1){newSlots[0].slots[f].available=false}}}else if(currentTime>session2StartTime&&currentTime<session2EndTime){if(session2EndTime>lateHours7&&lateHours7.getTime()-currentTime.getTime()<millisecondsIn2Hours){blockNextDaySlots(newSlots,earlyHoursSlotIndex);for(var h=currentSlotIndex;h<totalNumberOfSlotsSameDay;h+=1){newSlots[0].slots[h].available=false}}else if(session2EndTime<=lateHours7&&session2EndTime.getTime()-currentTime.getTime()<millisecondsIn2Hours){blockNextDaySlots(newSlots,earlyHoursSlotIndex)}}}else if(visitTimings[todayDateDay].session1_start_time!==""&&visitTimings[todayDateDay].session2_start_time===""){session1StartTime=setTime(currentTime,visitTimings[todayDateDay].session1_start_time);session1EndTime=setTime(currentTime,visitTimings[todayDateDay].session1_end_time);session1StartIndex=getSlotIndex(session1StartTime);session1EndIndex=getSlotIndex(session1EndTime);if(currentTime<session1StartTime){if(session1StartIndex<earlyHoursSlotIndex){var slotIndex2=session1StartIndex;while(slotIndex2!==earlyHoursSlotIndex){newSlots[0].slots[slotIndex2].available=false;slotIndex2+=1}for(var i=0;i<numberOfSlots2hours;i+=1){newSlots[0].slots[earlyHoursSlotIndex+i].available=false}}else{for(var j=0;j<numberOfSlots2hours;j+=1){newSlots[0].slots[session1StartIndex+j].available=false}if(lateHours7.getTime()-session1StartTime.getTime()<millisecondsIn2Hours){blockNextDaySlots(newSlots,earlyHoursSlotIndex);for(var k=session1StartIndex;k<totalNumberOfSlotsSameDay;k+=1){newSlots[0].slots[k].available=false}}}}else if(currentTime>session1StartTime&&currentTime<session1EndTime){if(session1EndTime>lateHours7&&lateHours7.getTime()-currentTime.getTime()<millisecondsIn2Hours){blockNextDaySlots(newSlots,earlyHoursSlotIndex)}else if(session1EndTime<=lateHours7&&session1EndTime.getTime()-currentTime.getTime()<millisecondsIn2Hours){blockNextDaySlots(newSlots,earlyHoursSlotIndex)}}if(session1EndTime.getTime()-session1StartTime.getTime()<millisecondsIn2Hours){blockNextDaySlots(newSlots,earlyHoursSlotIndex)}else if(session1EndTime.getTime()-currentTime.getTime()<millisecondsIn2Hours){blockNextDaySlots(newSlots,earlyHoursSlotIndex)}}else if(visitTimings[todayDateDay].session1_start_time===""&&visitTimings[todayDateDay].session2_start_time===""){blockNextDaySlots(newSlots,earlyHoursSlotIndex)}if(currentTime>lateHours){for(var l=currentSlotIndex;l<totalNumberOfSlotsSameDay;l+=1){newSlots[0].slots[l].available=false}blockNextDaySlots(newSlots,earlyHoursSlotIndex)}for(var m=0;m<=currentSlotIndex;m+=1){newSlots[0].slots[m].available=false}for(var n=0;n<=numberOfSlots2hours;n+=1){if(currentSlotIndex+n<totalNumberOfSlotsSameDay){newSlots[0].slots[currentSlotIndex+n].available=false}}return newSlots};var blockNextDaySlots=function(newSlots,earlyHoursSlotIndex){var numberOfSlots2hours=60*2/appointmentDuration;var currentTime=new Date;var count=1;nextDate=new Date(currentTime.getTime()+millisecondsInADay);nextDay=dayNames[nextDate.getDay()];while(visitTimings[nextDay].session1_start_time===""){count+=1;nextDate=new Date(nextDate.getTime()+millisecondsInADay);nextDay=dayNames[nextDate.getDay()]}var nextWorkingDaySession1StartTime=setTime(nextDate,visitTimings[nextDay].session1_start_time);var nextWorkingDaySession1StartTime=getSlotIndex(nextWorkingDaySession1StartTime);if(nextWorkingDaySession1StartTime<earlyHoursSlotIndex){var slotIndex3=nextWorkingDaySession1StartTime;while(slotIndex3!==earlyHoursSlotIndex){newSlots[count].slots[slotIndex3].available=false;slotIndex3+=1}for(var o=0;o<numberOfSlots2hours;o+=1){newSlots[count].slots[earlyHoursSlotIndex+o].available=false}}else{for(var p=0;p<numberOfSlots2hours;p+=1){newSlots[count].slots[nextWorkingDaySession1StartTime+p].available=false}}};slots["doctor_"+doctorId]=newSlots;$.ajax({url:(inFrame?"/doctorsearch":"")+"/health/core-api/practicedoctors/"+doctorId+"/slots",type:"GET",data:{only_token:true,with_relation:true},dataType:"json",success:function(response){tokens["doctor_"+doctorId]=response.appointment_token;thisDoc.clinic_timings=response.relation.visit_timings;thisDoc.labels=response.relation.labels||{doctor:"Doctor",patient:"Patient",practice:"Practice"};startingToday();renderCalendar()}})}else{from_date=new Date;from_date.setHours(0,0,0,0);to_date=new Date(from_date.getTime()+864e5*14);to_date.setHours(0,0,0,0);from_date.setTime(from_date.getTime()-1e3);var payload={with_relation:true,from:from_date.format("yyyy-mm-dd HH:MM:ss"),to:to_date.format("yyyy-mm-dd HH:MM:ss")};origin=$(el).data("origin");if($(el).data("adid")&&origin==="Listings"){payload.type="listing";payload.page=window.location.protocol+"//"+window.location.host+window.location.pathname;payload.id=$(el).data("adid");payload.token=$(el).data("token");payload.ad_click_activity="true"}inFrame=searchvars&&searchvars.inFrame!=="undefined"?searchvars.inFrame:false;$.ajax({url:(inFrame?"/doctorsearch":"")+"/health/core-api/practicedoctors/"+doctorId+"/slots",type:"GET",data:payload,dataType:"json",success:function(response){if(response){thisDoc=response.relation;slots["doctor_"+doctorId]=response.slots;tokens["doctor_"+doctorId]=response.appointment_token;renderCalendar()}}})}}else{renderCalendar()}});$(window).resize(function(){$(".button.day-switcher.prev").addClass("disabled");$(".button.day-switcher.prev").data("id","0");$(".button.day-switcher.next").removeClass("disabled");$(".slots-group").hide();if($(".page-body-container").width()>900||$(".patient-profile-view").length>0){$.each($(".slot-viewer"),function(){if($(this).find(".day-slot-grouping").length>0){$.each($(this).find(".day-slot-grouping"),function(){$(this).find(".day-slot-column:eq(0)").unwrap()})}$(this).find(".slots-group:lt(3)").show();$(this).find(".slots-group:gt(2)").hide()})}else{$.each($(".day-row"),function(){if($(this).find(".day-slot-grouping").length===0){$(this).find(".day-slot-column:eq(0),.day-slot-column:eq(1)").wrapAll($("<div></div>").addClass("day-slot-grouping"));$(this).find(".day-slot-column:eq(2),.day-slot-column:eq(3)").wrapAll($("<div></div>").addClass("day-slot-grouping"));$(this).find(".day-slot-column:eq(4),.day-slot-column:eq(5)").wrapAll($("<div></div>").addClass("day-slot-grouping"));$(this).find(".day-slot-column:eq(6)").wrapAll($("<div></div>").addClass("day-slot-grouping"))}});$.each($(".slot-viewer"),function(){$(this).find(".slots-group:eq(0)").show();$(this).find(".slots-group:gt(0)").hide()})}$(".searchForm select").trigger("chosen:redraw")});function showPatientForm(el){var suffix=$(el).data("adid")?"_"+$(el).data("adid"):$(el).data("uniqid")?"_"+$(el).data("uniqid"):"";$("#slotViewer"+$(el).data("doctorid")+suffix+" .slot-loader").remove();var temp=_.template($("#virtualnumberPatientForm").html(),{});var container=$("#slotViewer"+$(el).data("doctorid")+suffix);container.append(temp);var practiceDoctorId=$(el).data("doctorid");$(".vn_patient .getting-phone-text, .vn_patient .overlay",container).show();$.ajax({url:"/health/api/vn/vnpractice",type:"GET",data:{practice_doctor_id:practiceDoctorId},dataType:"JSON",success:function(vn_practice){var vnPractice=vn_practice;$(".vn_patient .getting-phone-text, .vn_patient .overlay",container).hide();vnPractice.extension=convertInto3Digit(vnPractice.extension);vnPractice.formatPhoneNumber=function(phoneNo,countryCode){if(countryCode=="IN"){return("0"+phoneNo.substring(3)).replace(/^(\d{3})(\d{4})(\d{4})$/,"$1 $2 $3")}else{return phoneNo.replace(/^([+\d]{3})(\d{4})(\d{4})$/,"$1 $2 $3")}};var temp=_.template($("#virtualnumberInformation").html(),vnPractice);container.find(".vn_patient").html(temp);adConversion();addSokratiTracking(practiceDoctorId,0)},error:function(resp){$(".vn_patient .getting-phone-text, .vn_patient .overlay",container).hide()}})}function adConversion(){$("#conversion-image").remove();var queryParams={value:"1.00",currency_code:"INR",label:"OKo2CK74vFcQt-KNygM",guid:"ON",script:0};$("<img/>",{height:1,width:1,id:"conversion-image",css:{"border-style":"none"},alt:"",src:"//www.googleadservices.com/pagead/conversion/960721207/?"+jQuery.param(queryParams)}).appendTo("body")}function convertInto3Digit(num){return("00"+num).slice(-3)}});function isScheduleEmpty(schedule){schedule=schedule?schedule:[];empty=true;newSchedule=[];if(typeof schedule!=="undefined"&&schedule!==null&&_.keys(schedule).length>0){_.each(days,function(thisDay){if(schedule[thisDay].session1_start_time!==""&&schedule[thisDay].session1_end_time!==""&&schedule[thisDay].session1_start_time!==schedule[thisDay].session1_end_time){empty=false}})}if(typeof schedule==="undefined"||schedule===null||_.keys(schedule).length===0||!isvalidTimings(schedule)){empty=true}if(empty){_.each(dayNames,function(thisDay){temp={};if(thisDay==="sunday"){temp.session1_start_time="";temp.session1_end_time="";temp.session2_start_time="";temp.session2_end_time=""}else{temp.session1_start_time="10: 00 ";temp.session1_end_time="19:00";temp.session2_start_time="";temp.session2_end_time=""}newSchedule[thisDay]=temp});return newSchedule}return schedule}function validSlots(slots,day,visitTimings){var dayMap={Mon:"monday",Tue:"tuesday",Wed:"wednesday",Thu:"thursday",Fri:"friday",Sat:"saturday",Sun:"sunday"};var minTime=visitTimings[dayMap[day]]?visitTimings[dayMap[day]].session1_start_time!==""?visitTimings[dayMap[day]].session1_start_time:"08:00":"08:00";var maxTime=visitTimings[dayMap[day]]?visitTimings[dayMap[day]].session2_end_time!==""?visitTimings[dayMap[day]].session2_end_time:visitTimings[dayMap[day]].session1_end_time!==""?visitTimings[dayMap[day]].session1_end_time:"21:30":"21:30";var filteredSlots=[];_.each(slots,function(thisSlot){session1StartTime=parseInt(visitTimings[dayMap[day]].session1_start_time.split(":").join(""),10);session1EndTime=parseInt(visitTimings[dayMap[day]].session1_end_time.split(":").join(""),10);session2StartTime=visitTimings[dayMap[day]].session2_start_time!==""?parseInt(visitTimings[dayMap[day]].session2_start_time.split(":").join(""),10):-1;session2EndTime=visitTimings[dayMap[day]].session2_end_time!==""?parseInt(visitTimings[dayMap[day]].session2_end_time.split(":").join(""),10):-1;thisSlot.outsideVisitHours=true;if(parseInt(thisSlot.ts.substr(11,5).split(":").join(""),10)>=session1StartTime&&parseInt(thisSlot.ts.substr(11,5).split(":").join(""),10)<session1EndTime){thisSlot.outsideVisitHours=false}if(session2StartTime!==-1&&session2EndTime!==-1&&(parseInt(thisSlot.ts.substr(11,5).split(":").join(""),10)>=session2StartTime&&parseInt(thisSlot.ts.substr(11,5).split(":").join(""),10)<session2EndTime)){thisSlot.outsideVisitHours=false}filteredSlots.push(thisSlot)});return filteredSlots}function isvalidTimings(timingsJSON){response=true;try{_.each(days,function(thisDay){if(timingsJSON[thisDay].session1_start_time===""&&timingsJSON[thisDay].session1_end_time===""&&timingsJSON[thisDay].session2_start_time===""&&timingsJSON[thisDay].session2_end_time===""){return}if(timingsJSON[thisDay].session1_start_time===""||timingsJSON[thisDay].session1_end_time===""){response=false}if(timingsJSON[thisDay].session2_start_time===""&&timingsJSON[thisDay].session2_end_time!==""){response=false}if(timingsJSON[thisDay].session2_start_time!==""&&timingsJSON[thisDay].session2_end_time===""){response=false}session1StartTime=parseInt(replaceAll(timingsJSON[thisDay].session1_start_time,":",""),10);session1EndTime=parseInt(replaceAll(timingsJSON[thisDay].session1_end_time,":",""),10);session2StartTime=parseInt(replaceAll(timingsJSON[thisDay].session2_start_time,":",""),10);session2EndTime=parseInt(replaceAll(timingsJSON[thisDay].session2_end_time,":",""),10);if(session1StartTime>=session1EndTime){response=false}if(timingsJSON[thisDay].session2_start_time&&timingsJSON[thisDay].session2_end_time){if(session1EndTime>=session2StartTime){response=false}if(session2StartTime>=session2EndTime){response=false}}})}catch(e){response=false}return response}
var imageTooltipTimeOutId=null;(function(){$.colorbox.settings.photo=true;$(".clinic_thumbs img").error(function(){$(this).attr("src",$(this).data("originalsrc"))});$(".clinic_thumbs").click(function(ev){ev.preventDefault();var doctorId=$(this).data("doctorid");$("a.clinic_photos_"+doctorId).colorbox({rel:"clinic_photos_"+doctorId,photo:true,current:"{current}/{total}"})});$(".clinic_thumbs img").mouseenter(function(){if(imageTooltipTimeOutId!=null){clearTimeout(imageTooltipTimeOutId);imageTooltipTimeOutId=null}el=$(this).parents(".doc-clinic-photos");tooltipTop=Math.floor($(el).offset().top+$(el).outerHeight()+12);drawTooltipBelowThumbnail=$(document).scrollTop()+$(window).innerHeight()/2<=tooltipTop;$("#imageTooltip .tooltip-notch").css("left",$(this).offset().left-$(el).offset().left+27+"px");if(!drawTooltipBelowThumbnail){$("#imageTooltip .tooltip-notch").removeClass("bottom-aligned");if($("#imageTooltip").css("top")!=tooltipTop+"px"){$("#imageTooltip").hide()}$("#imageTooltip").css({top:tooltipTop+"px",left:$(el).offset().left-25+"px",bottom:""})}else{$("#imageTooltip .tooltip-notch").addClass("bottom-aligned");tooltipTop=Math.floor($(window).height()-$(el).offset().top+8);if($("#imageTooltip").css("bottom")!=tooltipTop+"px"){$("#imageTooltip").hide()}$("#imageTooltip").css({bottom:tooltipTop+"px",left:$(el).offset().left-25+"px",top:""})}imageSrc=$(this).attr("src").indexOf("microthumbnail")>=0?replaceAll($(this).attr("src"),"microthumbnail","medium"):$(this).attr("src");$("#imageTooltip .imagetooltip-image-loader").show();$("#imageTooltip .imageTooltipImageContainer img").attr("src",imageSrc);$("#imageTooltip .imageTooltipImageContainer").hide();if($("#imageTooltip").css("display")=="none"){$("#imageTooltip").fadeIn()}});$("#imageTooltip .imageTooltipImageContainer img").load(function(){thisPhoto=this;if(thisPhoto.width<247){$(this).addClass("tall")}else{$(this).removeClass("tall")}$("#imageTooltip .imagetooltip-image-loader").hide();$("#imageTooltip .imageTooltipImageContainer").show()});$(".clinic_thumbs img").mouseout(function(){imageTooltipTimeOutId=setTimeout(function(){$("#imageTooltip").fadeOut()},500)});$("#seoInfoText").click(function(){$(this).find("p.seo-info-body").toggle();$(this).find("p.seo-info-head").toggleClass("open fold")});if(typeof ga!="undefined"&&searchvars.listingType=="doctors"){_.each(searchvars.results,function(thisDoctor,index){var payload={};_.extend(payload,gadimensions,{hitType:"event",eventCategory:"listings_impression",eventAction:"load",dimension1:"organic",dimension8:thisDoctor.doctor_id,dimension9:thisDoctor.practice_id,dimension16:index+(searchvars.currentPage-1)*10+1,dimension12:"organic",dimension13:"organic",dimension14:"organic"});ga("send",payload)})}if(isPatientLogin===true){$("body").practoNav("setSelectedLabel","Find a Doctor")}})();